import React, { useState } from 'react';
import { ArrowLeft, Users, Search, Bell, Grid3X3, List, Plus, TrendingUp, MessageSquare, Eye, ThumbsUp, Clock } from 'lucide-react';
import { Button } from './ui/button';
import { Badge } from './ui/badge';
import { Card, CardHeader, CardContent } from './ui/card';

interface Board {
  id: string;
  name: string;
  description: string;
  icon: string;
  memberCount: number;
  postCount: number;
  todayPostCount: number;
  color: string;
  category: 'ÏùºÎ∞ò' | 'Ï∑®ÎØ∏' | 'Ï†ïÎ≥¥' | 'ÏßàÎ¨∏';
  isHot: boolean;
  lastActivity: string;
}

export default function CommunityBoardsScreen() {
  const [viewMode, setViewMode] = useState<'grid' | 'list'>('grid');
  const [sortBy, setSortBy] = useState<'popular' | 'recent' | 'members'>('popular');

  const handleBack = () => {
    window.dispatchEvent(new CustomEvent('community-back'));
  };

  const sampleBoards: Board[] = [
    {
      id: '1',
      name: 'ÏûêÏú†Í≤åÏãúÌåê',
      description: 'ÏûêÏú†Î°≠Í≤å Ïù¥ÏïºÍ∏∞ÌïòÎäî Í≥µÍ∞Ñ',
      icon: 'üí¨',
      memberCount: 1234,
      postCount: 567,
      todayPostCount: 23,
      color: '#FFE4EB',
      category: 'ÏùºÎ∞ò',
      isHot: true,
      lastActivity: 'Î∞©Í∏à Ï†Ñ'
    },
    {
      id: '2',
      name: 'ÏßàÎ¨∏Í≥º ÎãµÎ≥Ä',
      description: 'Í∂ÅÍ∏àÌïú Í≤ÉÎì§ÏùÑ Î¨ºÏñ¥Î≥¥ÏÑ∏Ïöî',
      icon: '‚ùì',
      memberCount: 892,
      postCount: 234,
      todayPostCount: 12,
      color: '#DFF6FF',
      category: 'ÏßàÎ¨∏',
      isHot: true,
      lastActivity: '5Î∂Ñ Ï†Ñ'
    },
    {
      id: '3',
      name: 'Ï∑®ÎØ∏Í≥µÏú†',
      description: 'Ï∑®ÎØ∏Î•º Í≥µÏú†ÌïòÍ≥† Ìï®ÍªòÌï¥Ïöî',
      icon: 'üé®',
      memberCount: 567,
      postCount: 123,
      todayPostCount: 8,
      color: '#F3E8FF',
      category: 'Ï∑®ÎØ∏',
      isHot: false,
      lastActivity: '1ÏãúÍ∞Ñ Ï†Ñ'
    },
    {
      id: '4',
      name: 'Ï†ïÎ≥¥Í≥µÏú†',
      description: 'Ïú†Ïö©Ìïú Ï†ïÎ≥¥Î•º ÎÇòÎàÑÏñ¥Ïöî',
      icon: 'üìö',
      memberCount: 789,
      postCount: 345,
      todayPostCount: 15,
      color: '#E8F5E8',
      category: 'Ï†ïÎ≥¥',
      isHot: true,
      lastActivity: '30Î∂Ñ Ï†Ñ'
    },
    {
      id: '5',
      name: 'ÏùºÏ†ïÍ≥µÏú†',
      description: 'ÏùºÏ†ïÍ≥º Ïù¥Î≤§Ìä∏Î•º Í≥µÏú†ÌïòÏÑ∏Ïöî',
      icon: 'üìÖ',
      memberCount: 456,
      postCount: 89,
      todayPostCount: 4,
      color: '#FFF4E6',
      category: 'Ï†ïÎ≥¥',
      isHot: false,
      lastActivity: '2ÏãúÍ∞Ñ Ï†Ñ'
    },
    {
      id: '6',
      name: 'Ïö¥ÎèôÎ™®ÏûÑ',
      description: 'Ìï®Íªò Ïö¥ÎèôÌïòÏã§ Î∂ÑÎì§ Î™®Ïó¨Ïöî',
      icon: 'üèÉ‚Äç‚ôÇÔ∏è',
      memberCount: 234,
      postCount: 67,
      todayPostCount: 7,
      color: '#F0F8FF',
      category: 'Ï∑®ÎØ∏',
      isHot: false,
      lastActivity: '45Î∂Ñ Ï†Ñ'
    }
  ];

  const sortedBoards = [...sampleBoards].sort((a, b) => {
    switch (sortBy) {
      case 'popular':
        return b.postCount - a.postCount;
      case 'recent':
        return new Date(a.lastActivity).getTime() - new Date(b.lastActivity).getTime();
      case 'members':
        return b.memberCount - a.memberCount;
      default:
        return 0;
    }
  });

  const handleBoardClick = (board: Board) => {
    console.log('Í≤åÏãúÌåê ÌÅ¥Î¶≠:', board.name);
    // Í≤åÏãúÌåê ÏÉÅÏÑ∏ ÌéòÏù¥ÏßÄÎ°ú Ïù¥ÎèôÌïòÎäî Î°úÏßÅ Ï∂îÍ∞Ä ÏòàÏ†ï
  };

  const handleCreatePost = () => {
    console.log('ÏÉà Í≤åÏãúÍ∏Ä ÏûëÏÑ±');
    // Í≤åÏãúÍ∏Ä ÏûëÏÑ± Î™®Îã¨ ÎòêÎäî ÌéòÏù¥ÏßÄÎ°ú Ïù¥ÎèôÌïòÎäî Î°úÏßÅ Ï∂îÍ∞Ä ÏòàÏ†ï
  };

  const renderBoardCard = (board: Board) => (
    <Card 
      key={board.id}
      className="bg-gray-900 border-gray-800 hover:border-gray-600 transition-all duration-200 cursor-pointer hover:shadow-lg hover:shadow-blue-500/20"
      onClick={() => handleBoardClick(board)}
    >
      <CardHeader className="pb-3">
        <div className="flex items-center justify-between">
          <div className="flex items-center gap-3">
            <div 
              className="w-12 h-12 rounded-lg flex items-center justify-center text-xl"
              style={{ backgroundColor: board.color }}
            >
              {board.icon}
            </div>
            <div>
              <div className="flex items-center gap-2">
                <h3 className="font-medium text-white">{board.name}</h3>
                {board.isHot && (
                  <Badge variant="destructive" className="text-xs">
                    HOT
                  </Badge>
                )}
              </div>
              <p className="text-sm text-gray-400 mt-1">{board.description}</p>
            </div>
          </div>
        </div>
      </CardHeader>
      <CardContent className="pt-0">
        <div className="flex items-center justify-between text-sm text-gray-400 mb-3">
          <span>Î©§Î≤Ñ {board.memberCount.toLocaleString()}</span>
          <span>Í≤åÏãúÍ∏Ä {board.postCount}</span>
        </div>
        <div className="flex items-center justify-between">
          <Badge variant="outline" className="text-xs border-gray-600 text-gray-300">
            {board.category}
          </Badge>
          <div className="flex items-center gap-4 text-xs text-gray-500">
            <span className="flex items-center gap-1">
              <TrendingUp className="w-3 h-3" />
              Ïò§Îäò {board.todayPostCount}
            </span>
            <span>{board.lastActivity}</span>
          </div>
        </div>
      </CardContent>
    </Card>
  );

  const renderBoardList = (board: Board) => (
    <div 
      key={board.id}
      className="bg-gray-900 border border-gray-800 rounded-lg p-4 hover:border-gray-600 transition-all duration-200 cursor-pointer hover:shadow-lg hover:shadow-blue-500/20"
      onClick={() => handleBoardClick(board)}
    >
      <div className="flex items-center justify-between">
        <div className="flex items-center gap-3 flex-1">
          <div 
            className="w-10 h-10 rounded-lg flex items-center justify-center text-lg"
            style={{ backgroundColor: board.color }}
          >
            {board.icon}
          </div>
          <div className="flex-1">
            <div className="flex items-center gap-2 mb-1">
              <h3 className="font-medium text-white">{board.name}</h3>
              {board.isHot && (
                <Badge variant="destructive" className="text-xs">
                  HOT
                </Badge>
              )}
              <Badge variant="outline" className="text-xs border-gray-600 text-gray-300">
                {board.category}
              </Badge>
            </div>
            <p className="text-sm text-gray-400">{board.description}</p>
          </div>
        </div>
        <div className="text-right">
          <div className="flex items-center gap-4 text-xs text-gray-500 mb-1">
            <span className="flex items-center gap-1">
              <Users className="w-3 h-3" />
              {board.memberCount.toLocaleString()}
            </span>
            <span className="flex items-center gap-1">
              <MessageSquare className="w-3 h-3" />
              {board.postCount}
            </span>
          </div>
          <div className="flex items-center gap-2 text-xs text-gray-500">
            <span className="flex items-center gap-1 text-blue-400">
              <TrendingUp className="w-3 h-3" />
              Ïò§Îäò {board.todayPostCount}
            </span>
            <span>{board.lastActivity}</span>
          </div>
        </div>
      </div>
    </div>
  );

  return (
    <div className="min-h-screen bg-black text-white">
      {/* Ïª®Ìä∏Î°§ Î∞î */}
      <div className="flex items-center justify-between px-4 py-3 border-b border-gray-800">
        <div className="flex items-center gap-2">
          <select 
            value={sortBy} 
            onChange={(e) => setSortBy(e.target.value as any)}
            className="bg-gray-800 border border-gray-700 rounded px-3 py-1 text-sm text-white"
          >
            <option value="popular">Ïù∏Í∏∞Ïàú</option>
            <option value="recent">ÏµúÍ∑ºÏàú</option>
            <option value="members">Î©§Î≤ÑÏàú</option>
          </select>
        </div>
        <div className="flex items-center gap-2">
          <Button
            variant="ghost"
            size="sm"
            onClick={() => setViewMode('grid')}
            className={`h-8 w-8 p-0 ${viewMode === 'grid' ? 'text-blue-400' : 'text-gray-400'} hover:text-white`}
          >
            <Grid3X3 className="w-4 h-4" />
          </Button>
          <Button
            variant="ghost"
            size="sm"
            onClick={() => setViewMode('list')}
            className={`h-8 w-8 p-0 ${viewMode === 'list' ? 'text-blue-400' : 'text-gray-400'} hover:text-white`}
          >
            <List className="w-4 h-4" />
          </Button>
        </div>
      </div>

      {/* ÌÜµÍ≥Ñ ÏÑπÏÖò */}
      <div className="px-4 py-4 border-b border-gray-800">
        <div className="grid grid-cols-3 gap-4">
          <Button 
            variant="ghost"
            className="flex flex-col items-center gap-1 p-3 h-auto bg-gray-900/50 hover:bg-gray-800 transition-colors"
          >
            <Users className="w-5 h-5 text-blue-400" />
            <span className="text-lg font-medium">2.3K</span>
            <span className="text-xs text-gray-400">Ï¥ù Î©§Î≤Ñ</span>
          </Button>
          <Button 
            variant="ghost"
            className="flex flex-col items-center gap-1 p-3 h-auto bg-gray-900/50 hover:bg-gray-800 transition-colors"
          >
            <MessageSquare className="w-5 h-5 text-green-400" />
            <span className="text-lg font-medium">1.2K</span>
            <span className="text-xs text-gray-400">Ï¥ù Í≤åÏãúÍ∏Ä</span>
          </Button>
          <Button 
            variant="ghost"
            className="flex flex-col items-center gap-1 p-3 h-auto bg-gray-900/50 hover:bg-gray-800 transition-colors"
          >
            <TrendingUp className="w-5 h-5 text-yellow-400" />
            <span className="text-lg font-medium">69</span>
            <span className="text-xs text-gray-400">Ïò§Îäò ÌôúÎèô</span>
          </Button>
        </div>
      </div>

      {/* Í≤åÏãúÌåê Î™©Î°ù */}
      <div className="px-4 space-y-3 pb-24">
        {sortedBoards.map((board) => 
          viewMode === 'grid' ? renderBoardCard(board) : renderBoardList(board)
        )}
      </div>

      {/* ÌîåÎ°úÌåÖ Ïï°ÏÖò Î≤ÑÌäº */}
      <Button
        onClick={handleCreatePost}
        className="fixed bottom-6 right-4 w-14 h-14 rounded-full bg-blue-600 hover:bg-blue-700 shadow-lg hover:shadow-xl transition-all duration-200"
      >
        <Plus className="w-6 h-6" />
      </Button>
    </div>
  );
}